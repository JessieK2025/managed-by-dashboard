<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThreeFlow Managed Pilot Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Lato', sans-serif;
            background-color: #f9fafb;
            color: #1f2937;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        .header {
            background: white;
            border-bottom: 4px solid #00B980;
            padding: 32px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #000099;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #6b7280;
            font-size: 1.1rem;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .broker-select, .csv-upload {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            font-family: 'Lato', sans-serif;
            font-size: 14px;
            color: #374151;
            min-width: 200px;
        }
        
        .broker-select:focus, .csv-upload:focus {
            outline: none;
            border-color: #00B980;
        }
        
        .upload-btn {
            background: #00B980;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-family: 'Lato', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .upload-btn:hover {
            background: #1A7848;
        }
        
        .upload-status {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            display: none;
        }
        
        .upload-status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .upload-status.error {
            background: #fecaca;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 32px 0;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 6px solid;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .metric-card.primary { border-left-color: #00B980; }
        .metric-card.success { border-left-color: #1A7848; }
        .metric-card.secondary { border-left-color: #000099; }
        .metric-card.purple { border-left-color: #8A288E; }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .metric-icon.primary { background-color: #00B980; }
        .metric-icon.success { background-color: #1A7848; }
        .metric-icon.secondary { background-color: #000099; }
        .metric-icon.purple { background-color: #8A288E; }
        
        .metric-title {
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .metric-subtitle {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        /* Renewal Timeline Section */
        .renewal-section {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 40px 0;
        }
        
        .renewal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        
        .renewal-item {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #00B980;
            transition: transform 0.2s ease;
        }
        
        .renewal-item:hover {
            transform: translateY(-2px);
        }
        
        .renewal-month {
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .renewal-stats {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .renewal-progress {
            width: 100%;
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .renewal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00B980 0%, #1A7848 100%);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        /* Insights Section */
        .insights-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 2px solid #f59e0b;
            border-radius: 16px;
            padding: 32px;
            margin: 40px 0;
        }
        
        .insights-title {
            color: #92400e;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 32px;
        }
        
        .insights-column h4 {
            color: #1f2937;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 16px;
        }
        
        .insights-column ul {
            list-style: none;
        }
        
        .insights-column li {
            color: #374151;
            margin-bottom: 8px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.5);
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        /* Broker Performance */
        .brokers-section {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 40px 0;
        }
        
        .section-title {
            color: #000099;
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 32px;
            border-bottom: 3px solid #00B980;
            padding-bottom: 16px;
        }
        
        .broker-item {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .broker-item:hover {
            border-color: #00B980;
            box-shadow: 0 4px 12px rgba(0,185,128,0.15);
        }
        
        .broker-header {
            padding: 24px;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .broker-info h3 {
            font-weight: 700;
            font-size: 1.25rem;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .broker-stats {
            color: #6b7280;
            font-size: 0.95rem;
            margin-bottom: 12px;
        }
        
        .progress-container {
            width: 100%;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00B980 0%, #1A7848 100%);
            border-radius: 5px;
            transition: width 0.8s ease;
        }
        
        .completion-rate {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
        }
        
        .completion-rate.high { color: #1A7848; }
        .completion-rate.medium { color: #D7CC43; }
        .completion-rate.low { color: #ef4444; }
        
        .broker-details {
            padding: 24px;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: none;
        }
        
        .broker-details.expanded {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }
        
        .detail-item {
            text-align: center;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .detail-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .detail-label {
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .detail-item.complete .detail-value { color: #1A7848; }
        .detail-item.pending .detail-value { color: #D7CC43; }
        .detail-item.escalated .detail-value { color: #ef4444; }
        .detail-item.carriers .detail-value { color: #8A288E; }
        
        /* Footer */
        .footer {
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 32px 0;
            margin-top: 48px;
            text-align: center;
            color: #6b7280;
        }
        
        .threeflow-brand {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
        }
        
        .brand-dot {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #00B980 0%, #1A7848 100%);
            border-radius: 50%;
        }
        
        .chevron {
            transition: transform 0.3s ease;
            color: #6b7280;
        }
        
        .chevron.expanded {
            transform: rotate(90deg);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .insights-grid { grid-template-columns: 1fr; }
            .broker-header { flex-direction: column; text-align: center; gap: 16px; }
            .details-grid { grid-template-columns: repeat(2, 1fr); }
            .renewal-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="container">
            <h1>Managed by Three Flow Pilot</h1>
            <p>Document Collection Progress Dashboard</p>
            <div class="header-controls">
                <input type="file" id="csvFile" accept=".csv" class="csv-upload" />
                <button onclick="uploadCSV()" class="upload-btn">Upload New CSV</button>
                <div id="uploadStatus" class="upload-status"></div>
                
                <select class="broker-select" id="brokerSelect">
                    <option value="all">All Brokers</option>
                </select>
                
                <select class="broker-select" id="renewalFilter" multiple>
                    <option value="all" selected>All Renewal Dates</option>
                    <option value="2024-10-01">October 1, 2024</option>
                    <option value="2024-11-01">November 1, 2024</option>
                    <option value="2024-12-01">December 1, 2024</option>
                    <option value="2025-01-01">January 1, 2025</option>
                    <option value="2025-10-01">October 1, 2025</option>
                    <option value="2025-11-01">November 1, 2025</option>
                    <option value="2025-12-01">December 1, 2025</option>
                    <option value="2026-01-01">January 1, 2026</option>
                </select>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Renewal Timeline -->
        <div class="renewal-section">
            <h2 class="section-title">Renewal Timeline Analysis</h2>
            <div class="renewal-grid" id="renewalGrid">
                <!-- Renewal data will be populated here -->
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card primary">
                <div class="metric-header">
                    <div>
                        <div class="metric-title">Total Tasks</div>
                        <div class="metric-value" id="totalTasks">3,951</div>
                        <div class="metric-subtitle">Active collection tasks</div>
                    </div>
                    <div class="metric-icon primary">📄</div>
                </div>
            </div>
            
            <div class="metric-card success">
                <div class="metric-header">
                    <div>
                        <div class="metric-title">Completion Rate</div>
                        <div class="metric-value" id="completionRate">17.5%</div>
                        <div class="metric-subtitle">693 completed tasks</div>
                    </div>
                    <div class="metric-icon success">✅</div>
                </div>
            </div>
            
            <div class="metric-card secondary">
                <div class="metric-header">
                    <div>
                        <div class="metric-title">Active Brokers</div>
                        <div class="metric-value" id="activeBrokers">12</div>
                        <div class="metric-subtitle">Partner organizations</div>
                    </div>
                    <div class="metric-icon secondary">👥</div>
                </div>
            </div>
            
            <div class="metric-card purple">
                <div class="metric-header">
                    <div>
                        <div class="metric-title">Eligible Lives</div>
                        <div class="metric-value" id="eligibleLives">1.22M</div>
                        <div class="metric-subtitle">Total covered individuals</div>
                    </div>
                    <div class="metric-icon purple">🏥</div>
                </div>
            </div>
        </div>

        <!-- Key Insights -->
        <div class="insights-section">
            <div class="insights-title">
                ⚠️ Key Insights & Action Items
            </div>
            <div class="insights-grid">
                <div class="insights-column">
                    <h4 style="color: #000099;">⚠️ Priority Actions:</h4>
                    <ul>
                        <li>50.2% tasks still "Not Started" - need acceleration</li>
                        <li>242 tasks escalated - require immediate attention</li>
                        <li>Focus on top 3 brokers handling 80% of volume</li>
                        <li>Implement automated follow-up for stalled tasks</li>
                        <li>Review escalation processes for efficiency</li>
                    </ul>
                </div>
                <div class="insights-column">
                    <h4 style="color: #1A7848;">✅ Successes:</h4>
                    <ul>
                        <li>34.3% completion rate (Complete + Broker Provided)</li>
                        <li>Strong engagement with 72 different carriers</li>
                        <li>1.2M+ eligible lives being managed successfully</li>
                        <li>Consistent progress across major brokers</li>
                        <li>Effective collaboration with partner organizations</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Broker Performance -->
        <div class="brokers-section">
            <h2 class="section-title" id="brokerSectionTitle">Broker Performance Analysis</h2>
            <div id="brokerContainer">
                <!-- Broker data will be populated here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <p>Last updated: <span id="currentDate"></span> | Data source: ThreeFlow Workspace</p>
            <div class="threeflow-brand">
                <div class="brand-dot"></div>
                <span style="font-weight: 600; color: #1f2937;">ThreeFlow</span>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let csvData = [];
        let processedData = {};
        
        // Set current date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString();
        
        // CSV Processing Functions
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let j = 0; j < lines[i].length; j++) {
                    const char = lines[i][j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());
                
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                data.push(row);
            }
            
            return data;
        }
        
        function processCSVData(data) {
            // Process broker statistics
            const brokerGroups = {};
            const renewalGroups = {};
            const overallStats = {
                totalTasks: data.length,
                completed: 0,
                brokers: new Set(),
                carriers: new Set(),
                totalLives: 0,
                collectionStatus: {},
                renewalStatus: {}
            };
            
            data.forEach(row => {
                const broker = row['Broker (drop down)'] || 'Unknown';
                const carrier = row['Carrier (short text)'] || 'Unknown';
                const collectionStatus = row['Collection Status (drop down)'] || 'Unknown';
                const renewalStatus = row['Renewal Doc Status (drop down)'] || 'Unknown';
                const renewalDate = row['Renewal date (date)'] || '';
                const eligibleLives = parseInt(row['Eligible Lives (number)']) || 0;
                
                // Track overall stats
                overallStats.brokers.add(broker);
                overallStats.carriers.add(carrier);
                overallStats.totalLives += eligibleLives;
                overallStats.collectionStatus[collectionStatus] = (overallStats.collectionStatus[collectionStatus] || 0) + 1;
                overallStats.renewalStatus[renewalStatus] = (overallStats.renewalStatus[renewalStatus] || 0) + 1;
                
                if (collectionStatus === 'Complete') {
                    overallStats.completed++;
                }
                
                // Group by broker
                if (!brokerGroups[broker]) {
                    brokerGroups[broker] = {
                        name: broker,
                        tasks: [],
                        totalTasks: 0,
                        completed: 0,
                        pending: 0,
                        escalated: 0,
                        brokerProvided: 0,
                        notStarted: 0,
                        carriers: new Set(),
                        totalLives: 0
                    };
                }
                
                brokerGroups[broker].tasks.push(row);
                brokerGroups[broker].totalTasks++;
                brokerGroups[broker].carriers.add(carrier);
                brokerGroups[broker].totalLives += eligibleLives;
                
                switch(collectionStatus) {
                    case 'Complete': brokerGroups[broker].completed++; break;
                    case 'Pending': brokerGroups[broker].pending++; break;
                    case 'Escalated': brokerGroups[broker].escalated++; break;
                    case 'Broker Provided': brokerGroups[broker].brokerProvided++; break;
                    case 'Not started': brokerGroups[broker].notStarted++; break;
                }
                
                // Group by renewal date (extract year-month)
                if (renewalDate) {
                    const dateMatch = renewalDate.match(/(\w+)\s+\d+\w*\s+(\d{4})/);
                    if (dateMatch) {
                        const month = dateMatch[1];
                        const year = dateMatch[2];
                        const key = `${year}-${month}`;
                        
                        if (!renewalGroups[key]) {
                            renewalGroups[key] = {
                                period: `${month} ${year}`,
                                total: 0,
                                collected: 0,
                                notCollected: 0,
                                tasks: []
                            };
                        }
                        
                        renewalGroups[key].total++;
                        renewalGroups[key].tasks.push(row);
                        
                        if (renewalStatus === 'Renewal Collected') {
                            renewalGroups[key].collected++;
                        } else {
                            renewalGroups[key].notCollected++;
                        }
                    }
                }
            });
            
            return {
                brokers: Object.values(brokerGroups),
                renewals: Object.values(renewalGroups).sort((a, b) => a.period.localeCompare(b.period)),
                overall: {
                    ...overallStats,
                    brokers: overallStats.brokers.size,
                    carriers: overallStats.carriers.size,
                    completionRate: (overallStats.completed / overallStats.totalTasks * 100).toFixed(1)
                }
            };
        }
        
        function updateUI() {
            updateMetrics();
            updateBrokerDropdown();
            updateRenewalDropdown();
            updateRenewalTimeline();
            updateBrokerSection();
            updateInsights();
        }
        
        function updateMetrics() {
            if (!processedData.overall) return;
            
            const stats = processedData.overall;
            document.getElementById('totalTasks').textContent = stats.totalTasks.toLocaleString();
            document.getElementById('completionRate').textContent = stats.completionRate + '%';
            document.getElementById('activeBrokers').textContent = stats.brokers;
            document.getElementById('eligibleLives').textContent = formatNumber(stats.totalLives);
            
            // Update subtitle
            const completionSubtitle = document.querySelector('#completionRate').parentElement.querySelector('.metric-subtitle');
            completionSubtitle.textContent = stats.completed + ' completed tasks';
        }
        
        function updateBrokerDropdown() {
            const select = document.getElementById('brokerSelect');
            select.innerHTML = '<option value="all">All Brokers</option>';
            
            processedData.brokers.forEach(broker => {
                const option = document.createElement('option');
                option.value = broker.name;
                option.textContent = broker.name;
                select.appendChild(option);
            });
        }
        
        
        function updateRenewalDropdown() {
            const select = document.getElementById('renewalFilter');
            // Keep the default multi-select options, but add dynamic ones from CSV
            const existingOptions = Array.from(select.options).map(opt => opt.value);
            
            processedData.renewals.forEach(renewal => {
                const value = renewal.period.toLowerCase().replace(' ', '-');
                if (!existingOptions.includes(value)) {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = renewal.period;
                    select.appendChild(option);
                }
            });
        }
        
        function updateRenewalTimeline() {
            const container = document.getElementById('renewalGrid');
            container.innerHTML = '';
            
            processedData.renewals.slice(0, 12).forEach(renewal => {
                const collectionRate = (renewal.collected / renewal.total * 100).toFixed(1);
                
                const item = document.createElement('div');
                item.className = 'renewal-item';
                item.innerHTML = `
                    <div class="renewal-month">${renewal.period}</div>
                    <div class="renewal-stats">${renewal.total} renewals • ${renewal.collected} collected</div>
                    <div class="renewal-progress">
                        <div class="renewal-progress-fill" style="width: ${collectionRate}%"></div>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function updateBrokerSection() {
            const container = document.getElementById('brokerContainer');
            container.innerHTML = '';
            
            processedData.brokers
                .sort((a, b) => b.totalTasks - a.totalTasks)
                .forEach((broker, index) => {
                    const completionRate = (broker.completed / broker.totalTasks * 100).toFixed(1);
                    const rateClass = completionRate > 20 ? 'high' : completionRate > 15 ? 'medium' : 'low';
                    
                    const brokerDiv = document.createElement('div');
                    brokerDiv.className = 'broker-item';
                    brokerDiv.innerHTML = `
                        <div class="broker-header" onclick="toggleBroker('broker${index}')">
                            <div class="broker-info">
                                <h3>${broker.name}</h3>
                                <div class="broker-stats">${broker.totalTasks} tasks • ${broker.carriers.size} carriers • ${formatNumber(broker.totalLives)} lives</div>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${completionRate}%"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="completion-rate ${rateClass}">${completionRate}%</div>
                                <span class="chevron" id="chevron${index}">▶</span>
                            </div>
                        </div>
                        <div class="broker-details" id="details${index}">
                            <div class="details-grid">
                                <div class="detail-item complete">
                                    <div class="detail-value">${broker.completed}</div>
                                    <div class="detail-label">Complete</div>
                                </div>
                                <div class="detail-item pending">
                                    <div class="detail-value">${broker.pending}</div>
                                    <div class="detail-label">Pending</div>
                                </div>
                                <div class="detail-item escalated">
                                    <div class="detail-value">${broker.escalated}</div>
                                    <div class="detail-label">Escalated</div>
                                </div>
                                <div class="detail-item carriers">
                                    <div class="detail-value">${broker.carriers.size}</div>
                                    <div class="detail-label">Carriers</div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(brokerDiv);
                });
        }
        
        function updateInsights() {
            const priorityList = document.querySelector('.insights-column ul');
            const successList = document.querySelector('.insights-column:last-child ul');
            
            if (!processedData.overall) return;
            
            const stats = processedData.overall;
            const notStartedPercent = ((stats.collectionStatus['Not started'] || 0) / stats.totalTasks * 100).toFixed(1);
            const escalatedCount = stats.collectionStatus['Escalated'] || 0;
            
            priorityList.innerHTML = `
                <li>${notStartedPercent}% tasks still "Not Started" - need acceleration</li>
                <li>${escalatedCount} tasks escalated - require immediate attention</li>
                <li>Focus on top 3 brokers handling majority of volume</li>
                <li>Implement automated follow-up for stalled tasks</li>
                <li>Review escalation processes for efficiency</li>
            `;
            
            const completedAndProvided = (stats.collectionStatus['Complete'] || 0) + (stats.collectionStatus['Broker Provided'] || 0);
            const totalCompletionRate = (completedAndProvided / stats.totalTasks * 100).toFixed(1);
            
            successList.innerHTML = `
                <li>${totalCompletionRate}% completion rate (Complete + Broker Provided)</li>
                <li>Strong engagement with ${stats.carriers} different carriers</li>
                <li>${formatNumber(stats.totalLives)} eligible lives being managed</li>
                <li>Consistent progress across ${stats.brokers} broker partners</li>
                <li>Effective collaboration with partner organizations</li>
            `;
        }
        
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return Math.round(num / 1000) + 'K';
            } else {
                return num.toString();
            }
        }
        
        // Toggle broker details
        function toggleBroker(brokerId) {
            const details = document.getElementById('details' + brokerId.replace('broker', ''));
            const chevron = document.getElementById('chevron' + brokerId.replace('broker', ''));
            
            if (details && chevron) {
                details.classList.toggle('expanded');
                chevron.classList.toggle('expanded');
            }
        }
        
        // CSV Upload functionality
        function uploadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            const statusDiv = document.getElementById('uploadStatus');
            
            if (!file) {
                showStatus('Please select a CSV file first.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    csvData = parseCSV(e.target.result);
                    processedData = processCSVData(csvData);
                    updateUI();
                    showStatus(`Successfully loaded ${csvData.length} records from CSV!`, 'success');
                } catch (error) {
                    showStatus('Error processing CSV: ' + error.message, 'error');
                    console.error('CSV processing error:', error);
                }
            };
            reader.readAsText(file);
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.textContent = message;
            statusDiv.className = `upload-status ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        // Initialize with sample data
        function initializeSampleData() {
            // This creates sample data similar to your CSV structure
            const sampleData = [];
            const brokers = ["McGohan Brabender", "The Baldwin Group - Southwest", "McGriff Insurance - Blue Ridge", "Marsh McLennan - Virginia", "CAC Agency", "Marsh McLennan - Florida"];
            const carriers = ["Standard", "Blue Cross Blue Shield", "Equitable", "Guardian", "Mutual Of Omaha", "Delta Dental"];
            const statuses = ["Not started", "Pending", "Escalated", "Complete", "Broker Provided"];
            
            for (let i = 0; i < 1000; i++) {
                sampleData.push({
                    "Task ID": `task_${i}`,
                    "Task Name": `Sample Task ${i}`,
                    "Broker (drop down)": brokers[Math.floor(Math.random() * brokers.length)],
                    "Carrier (short text)": carriers[Math.floor(Math.random() * carriers.length)],
                    "Collection Status (drop down)": statuses[Math.floor(Math.random() * statuses.length)],
                    "Renewal Doc Status (drop down)": Math.random() > 0.7 ? "Renewal Collected" : "Renewal Not Collected",
                    "Renewal date (date)": `${['January', 'February', 'March', 'April', 'May', 'June'][Math.floor(Math.random() * 6)]} ${Math.floor(Math.random() * 28) + 1}, ${2025 + Math.floor(Math.random() * 3)}`,
                    "Eligible Lives (number)": Math.floor(Math.random() * 500) + 10
                });
            }
            
            csvData = sampleData;
            processedData = processCSVData(csvData);
            updateUI();
        }
        
        // Filter functionality
        document.getElementById('brokerSelect').addEventListener('change', function() {
            const selectedBroker = this.value;
            applyFilters();
        });
        
        document.getElementById('renewalFilter').addEventListener('change', function() {
            const selectedRenewals = Array.from(this.selectedOptions).map(option => option.value);
            applyFilters();
        });
        
        function applyFilters() {
            const selectedBroker = document.getElementById('brokerSelect').value;
            const selectedRenewals = Array.from(document.getElementById('renewalFilter').selectedOptions).map(option => option.value);
            
            let filteredData = csvData;
            
            // Filter by broker
            if (selectedBroker !== 'all') {
                filteredData = filteredData.filter(row => row['Broker (drop down)'] === selectedBroker);
            }
            
            // Filter by renewal dates
            if (!selectedRenewals.includes('all')) {
                filteredData = filteredData.filter(row => {
                    const renewalDate = row['Renewal date (date)'] || '';
                    return selectedRenewals.some(selectedDate => {
                        if (selectedDate.includes('2024-10-01') || selectedDate.includes('2025-10-01')) {
                            return renewalDate.toLowerCase().includes('october') && renewalDate.includes('1');
                        } else if (selectedDate.includes('2024-11-01') || selectedDate.includes('2025-11-01')) {
                            return renewalDate.toLowerCase().includes('november') && renewalDate.includes('1');
                        } else if (selectedDate.includes('2024-12-01') || selectedDate.includes('2025-12-01')) {
                            return renewalDate.toLowerCase().includes('december') && renewalDate.includes('1');
                        } else if (selectedDate.includes('2025-01-01') || selectedDate.includes('2026-01-01')) {
                            return renewalDate.toLowerCase().includes('january') && renewalDate.includes('1');
                        }
                        return false;
                    });
                });
            }
            
            // Reprocess with filtered data
            const filteredProcessedData = processCSVData(filteredData);
            processedData = filteredProcessedData;
            
            // Update UI
            updateMetrics();
            updateRenewalTimeline();
            updateBrokerSection();
            updateInsights();
            
            // Update section title
            const sectionTitle = document.getElementById('brokerSectionTitle');
            if (selectedBroker === 'all') {
                sectionTitle.textContent = 'Broker Performance Analysis';
            } else {
                sectionTitle.textContent = `${selectedBroker} - Detailed Analysis`;
            }
            
            // Show filter status
            let filterStatus = '';
            if (selectedBroker !== 'all') {
                filterStatus += `Broker: ${selectedBroker}`;
            }
            if (!selectedRenewals.includes('all')) {
                const renewalText = selectedRenewals.map(date => {
                    if (date.includes('10-01')) return 'Oct 1';
                    if (date.includes('11-01')) return 'Nov 1';
                    if (date.includes('12-01')) return 'Dec 1';
                    if (date.includes('01-01')) return 'Jan 1';
                    return date;
                }).join(', ');
                filterStatus += (filterStatus ? ' | ' : '') + `Renewals: ${renewalText}`;
            }
            
            if (filterStatus) {
                showStatus(`Filtered: ${filterStatus} (${filteredData.length} tasks)`, 'success');
            }
        }
        
            // Initialize on page load
        window.addEventListener('load', function() {
            initializeSampleData();
            
            // Animate progress bars
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.progress-fill, .renewal-progress-fill');
                progressBars.forEach(bar => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100);
                });
            }, 500);
        });
        
        console.log('ThreeFlow Dashboard with CSV upload loaded successfully!');
    </script>
</body>
</html> {
                    mcgohan: 'McGohan Brabender',
                    baldwin: 'The Baldwin Group - Southwest',
                    mcgriff: 'McGriff Insurance - Blue Ridge',
                    'marsh-va': 'Marsh McLennan - Virginia',
                    cac: 'CAC Agency',
                    'marsh-fl': 'Marsh McLennan - Florida'
                };
                
                const brokerName = brokerNames[selectedBroker];
                const data = brokerData[selectedBroker];
                
                priorityList.innerHTML = `
                    <li>Focus on ${brokerName} performance optimization</li>
                    <li>Review escalated tasks for this broker</li>
                    <li>Implement targeted follow-up processes</li>
                    <li>Assess carrier relationships and efficiency</li>
                    <li>Monitor completion rate trends over time</li>
                `;
                successList.innerHTML = `
                    <li>${data.metrics.completionRate} completion rate for ${brokerName}</li>
                    <li>${data.metrics.totalTasks} total tasks being managed</li>
                    <li>${data.metrics.eligibleLives} eligible lives covered</li>
                    <li>Active engagement with carrier partners</li>
                    <li>Consistent task processing and follow-through</li>
                `;
            }
        }
        
        // Broker filtering functionality
        document.getElementById('brokerSelect').addEventListener('change', function() {
            const selectedBroker = this.value;
            console.log('Filtering by broker:', selectedBroker);
            
            // Update metrics
            const data = brokerData[selectedBroker];
            if (data) {
                updateMetrics(data.metrics);
                filterBrokers(data.brokers);
                updateInsights(selectedBroker);
                
                // Update section title
                const sectionTitle = document.querySelector('.section-title');
                if (selectedBroker === 'all') {
                    sectionTitle.textContent = 'Broker Performance Analysis';
                } else {
                    const brokerNames = {
                        mcgohan: 'McGohan Brabender',
                        baldwin: 'The Baldwin Group - Southwest',
                        mcgriff: 'McGriff Insurance - Blue Ridge',
                        'marsh-va': 'Marsh McLennan - Virginia',
                        cac: 'CAC Agency',
                        'marsh-fl': 'Marsh McLennan - Florida'
                    };
                    sectionTitle.textContent = `${brokerNames[selectedBroker]} - Detailed Analysis`;
                }
                
                // Re-animate progress bars
                setTimeout(() => {
                    const progressBars = document.querySelectorAll('.progress-fill');
                    progressBars.forEach(bar => {
                        const width = bar.style.width;
                        bar.style.width = '0%';
                        setTimeout(() => {
                            bar.style.width = width;
                        }, 100);
                    });
                }, 100);
            }
        });
        
        // Animate progress bars on load
        window.addEventListener('load', function() {
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 500);
            });
        });
        
        console.log('ThreeFlow Dashboard loaded successfully!');
    </script>
</body>
</html>
